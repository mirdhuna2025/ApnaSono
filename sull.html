<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Listings (React + Firebase 10)</title>

<!-- React -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
:root{
  --primary:#25D366;
  --danger:#ef4444;
  --bg:#f4f6f8;
  --card:#ffffff;
  --radius:14px;
  --shadow:0 10px 25px rgba(0,0,0,.08);
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg)}
#listingsContainer{max-width:760px;margin:auto;padding:16px}

.rainbow-header{
  text-align:center;
  font-size:32px;
  font-weight:800;
  padding:18px 0;
  background: linear-gradient(
    90deg,
    red,
    orange,
    yellow,
    green,
    blue,
    indigo,
    violet
  );
  background-size: 400% 400%;
  animation: rainbow 6s ease infinite;

  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

@keyframes rainbow {
  0% { background-position: 0% 50% }
  50% { background-position: 100% 50% }
  100% { background-position: 0% 50% }
}
  
  /* Card */

  
.item-card{
  background:var(--card);
  border-radius:var(--radius);
  margin-bottom:16px;
  box-shadow:var(--shadow);
  overflow:hidden;
}
.item-info{padding:12px}
.item-title{font-weight:600}
.item-price{color:var(--danger);font-weight:700}

/* Slider */
.slider{position:relative}
.slider img{
  width:100%;
  height:220px;
  object-fit:fill;
}
.dots{
  position:sticky;
  bottom:8px;
  width:100%;
  display:flex;
  justify-content:center;
  gap:6px;
}
.dot{
  width:8px;height:8px;border-radius:50%;
  background:#ddd;
}
.dot.active{background:#25D366}

/* Buttons */
.btn{
   position:sticky;
  left: 250px !important;

  padding:10px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:600;
}
.btn-success{background:#25D366;color:#fff}

/* FAB */
.fab {
  position: fixed;
  bottom: 22px;
  right: 22px;

  width: 75px;
  height: 75px;
  border-radius: 50%;

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;

  background: linear-gradient(135deg, #ff6a00, #ff3d00);
  color: white;
  border: none;

  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  cursor: pointer;
  transition: 0.3s;
  z-index: 9999;
}

  .fab::after {
  content: '';
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: inherit;
  background: inherit;
  filter: blur(12px);
  opacity: 0.5;
  z-index: -1;
}
  #modalContent{
  position:relative;   /* required for absolute positioning */
}

.close-btn{
  position:absolute;
  top:10px;
  right:12px;
  background:none;
  border:none;
  font-size:18px;
  cursor:pointer;
  font-weight:bold;
  color:#555;
}

.close-btn:hover{
  color:#ef4444;
}
/* Modal */
#modalBackdrop{
  position:fixed;inset:0;
  background:rgba(0,0,0,.55);
  display:flex;
  align-items:center;
  justify-content:center;
}
#modalContent{
  background:#fff;
  width:92%;
  max-width:420px;
  padding:18px;
  border-radius:14px;
}
#modalContent input{
  width:100%;
  padding:12px;
  margin-bottom:10px;
}
</style>
</head>

<body>
<div id="root"></div>
  <div class="rainbow-header">  SONO OLX </div>

<!-- Firebase v10.12.2 -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getStorage, ref, listAll, getDownloadURL, uploadBytes
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

window.firebase = (() => {
  const firebaseConfig = {
    apiKey: "AIzaSyCPbOZwAZEMiC1LSDSgnSEPmSxQ7-pR2oQ",
    authDomain: "mirdhuna-25542.firebaseapp.com",
    projectId: "mirdhuna-25542",
    storageBucket: "mirdhuna-25542.firebasestorage.app",
    appId: "1:575924409876:web:6ba1ed88ce941d9c83b901"
  };
  const app = initializeApp(firebaseConfig);
  return {
    storage: getStorage(app),
    ref, listAll, getDownloadURL, uploadBytes
  };
})();
</script>

<script type="text/babel">
const {useState,useEffect} = React;
const ADMIN_MOBILE="6303438082";

/* Image Slider */
function Slider({images}){
  const [i,setI]=useState(0);
  useEffect(()=>{
    if(images.length<2) return;
    const t=setInterval(()=>setI(x=>(x+1)%images.length),3000);
    return ()=>clearInterval(t);
  },[images]);
  return(
    <div className="slider">
      <img src={images[i]} />
      <div className="dots">
        {images.map((_,d)=>(
          <span key={d} className={"dot "+(d===i?"active":"")}></span>
        ))}
      </div>
    </div>
  );
}

function App(){
  const [listings,setListings]=useState([]);
  const [modal,setModal]=useState(false);
  const [form,setForm]=useState({});
  const [files,setFiles]=useState([]);

  /* LOAD LISTINGS (original logic preserved) */
  useEffect(()=>{
    const load=async()=>{
      const {storage,ref,listAll,getDownloadURL}=window.firebase;
      const folder=ref(storage,"listings");
      const res=await listAll(folder);

      const items=await Promise.all(
        res.prefixes.map(async p=>{
          const meta=await getDownloadURL(ref(storage,p.fullPath+"/data.json"));
          return await (await fetch(meta)).json();
        })
      );
      items.sort((a,b)=>b.createdAt-a.createdAt);
      setListings(items);
    };
    load();
  },[]);

  /* SEND TO ADMIN */
async function sendToAdmin(e){
  e.preventDefault();

  const { storage, ref, uploadBytes, getDownloadURL } = window.firebase;

  const id = Date.now().toString();
  const basePath = "pendingListings/" + id;

  const imageUrls = [];
  for(const f of files){
    const imgRef = ref(storage, `${basePath}/images/${f.name}`);
    await uploadBytes(imgRef, f);
    imageUrls.push(await getDownloadURL(imgRef));
  }

  const data = {
    ...form,
    images: imageUrls,
    status: "pending",
    createdAt: Date.now()
  };

  const blob = new Blob([JSON.stringify(data)], { type: "application/json" });
  await uploadBytes(ref(storage, `${basePath}/data.json`), blob);

  alert("âœ… Listing sent for admin approval");
  setModal(false);
}

  return(
    <>
      <button className="fab" onClick={()=>setModal(true)}>+ sell</button>

      <div id="listingsContainer">
        {listings.map((i,idx)=>(
          <div className="item-card" key={idx}>
            <Slider images={i.images}/>
            <div className="item-info">
              <div className="item-title">{i.title}</div>
              <div className="item-price">â‚¹{i.price}</div>
              <a className="btn btn-success"
                 target="_blank"
                 href={`https://wa.me/91${i.mobile}`}>
                 ðŸ’¬ WhatsApp
              </a>
            </div>
          </div>
        ))}
      </div>



      
    {modal && (
  <div id="modalBackdrop" onClick={()=>setModal(false)}>
    <div id="modalContent" onClick={(e)=>e.stopPropagation()}>
      
      <button 
        className="close-btn" 
        onClick={()=>setModal(false)}
      >
        âœ–
      </button>
            <h3>Add Listing</h3>
            <form onSubmit={sendToAdmin}>
              <input placeholder="Title" required onChange={e=>setForm({...form,title:e.target.value})}/>
              <input type="number" placeholder="Price" required onChange={e=>setForm({...form,price:e.target.value})}/>
              <input placeholder="Location" required onChange={e=>setForm({...form,location:e.target.value})}/>
              <input placeholder="Mobile" onChange={e=>setForm({...form,mobile:e.target.value})}/>
              <input type="file" multiple accept="image/*" required onChange={e=>setFiles([...e.target.files])}/>
              <button className="btn btn-success">Send to Admin</button>
            </form>
          </div>
        </div>
      )}
    </>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>

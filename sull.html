<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Listings (React + Firebase 10)</title>

<!-- React -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
:root{
  --primary:#25D366;
  --danger:#ef4444;
  --bg:#f4f6f8;
  --card:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --radius:14px;
  --shadow:0 10px 25px rgba(0,0,0,.08);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:var(--bg);
  color:var(--text);
}

/* FAB */
.fab{
  position:fixed;
  bottom:22px;
  right:22px;
  width:58px;
  height:58px;
  border-radius:50%;
  background:var(--primary);
  color:#fff;
  font-size:28px;
  border:none;
  cursor:pointer;
  box-shadow:0 12px 30px rgba(37,211,102,.4);
  z-index:1000;
}

/* Listings */
#listingsContainer{
  max-width:760px;
  margin:auto;
  padding:16px;
}

/* Card */
.item-card{
  display:flex;
  gap:14px;
  background:var(--card);
  border-radius:var(--radius);
  margin-bottom:14px;
  box-shadow:var(--shadow);
  overflow:hidden;
}
.item-img img{
  width:120px;
  height:120px;
  object-fit:cover;
  cursor:pointer;
}
.item-info{padding:12px;flex:1}
.item-title{font-weight:600}
.item-price{color:var(--danger);font-weight:700}
.meta-badge{
  background:#f1f5f9;
  padding:4px 8px;
  border-radius:999px;
  font-size:12px;
}
.btn{
  padding:10px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:600;
  text-decoration:none;
}
.btn-success{background:var(--primary);color:#fff}
.btn-secondary{background:#e5e7eb}

/* Modal */
#modalBackdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
}
#modalContent{
  background:#fff;
  width:92%;
  max-width:420px;
  padding:18px;
  border-radius:14px;
}
#modalContent input{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:10px;
  border:1px solid #e5e7eb;
}
.empty-state{text-align:center;color:var(--muted);padding:40px}
</style>
</head>

<body>
<div id="root"></div>

<!-- Firebase v10.12.2 -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getStorage, ref, listAll, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

window.firebaseStorage = (() => {
  const firebaseConfig = {
    apiKey: "AIzaSyCPbOZwAZEMiC1LSDSgnSEPmSxQ7-pR2oQ",
    authDomain: "mirdhuna-25542.firebaseapp.com",
    projectId: "mirdhuna-25542",
    storageBucket: "mirdhuna-25542.firebasestorage.app",
    messagingSenderId: "575924409876",
    appId: "1:575924409876:web:6ba1ed88ce941d9c83b901"
  };

  const app = initializeApp(firebaseConfig);
  return { getStorage, ref, listAll, getDownloadURL, storage: getStorage(app) };
})();
</script>

<script type="text/babel">
const { useState, useEffect } = React;
const ADMIN_MOBILE = "6303438082";

function App(){
  const [listings,setListings]=useState([]);
  const [loading,setLoading]=useState(true);
  const [modal,setModal]=useState(false);
  const [preview,setPreview]=useState(null);
  const [form,setForm]=useState({title:"",price:"",location:"",mobile:""});

  useEffect(()=>{
    const load = async()=>{
      const { storage, ref, listAll, getDownloadURL } = window.firebaseStorage;
      const folder = ref(storage,"listings");
      const res = await listAll(folder);

      const items = await Promise.all(res.items.map(async f=>{
        const url = await getDownloadURL(f);
        return await (await fetch(url)).json();
      }));

      items.sort((a,b)=>b.createdAt-a.createdAt);
      setListings(items);
      setLoading(false);
    };
    load();
  },[]);

  function sendToAdmin(e){
    e.preventDefault();
    const msg=`Hello Admin,

New Listing Request:

üõí ${form.title}
üí∞ ‚Çπ${Number(form.price).toLocaleString()}
üìç ${form.location}
üì± ${form.mobile||"Not provided"}`;

    window.open(
      `https://wa.me/91${ADMIN_MOBILE}?text=${encodeURIComponent(msg)}`,
      "_blank"
    );
    setModal(false);
  }

  return (
    <>
      <button className="fab" onClick={()=>setModal(true)}>+</button>

      <div id="listingsContainer">
        {loading && <div className="empty-state">Loading‚Ä¶</div>}
        {!loading && listings.length===0 && <div className="empty-state">No listings yet</div>}

        {listings.map((i,idx)=>(
          <div className="item-card" key={idx}>
            <div className="item-img">
              <img src={i.imageUrl} onClick={()=>window.open(i.imageUrl)} />
            </div>
            <div className="item-info">
              <div className="item-title">{i.title}</div>
              <div className="item-price">‚Çπ{i.price.toLocaleString()}</div>
              <span className="meta-badge">üìç {i.location}</span>
              <div style={{marginTop:10}}>
                <a className="btn btn-success"
                   target="_blank"
                   href={`https://wa.me/91${i.mobile}?text=${encodeURIComponent("Interested in "+i.title)}`}>
                  üí¨ WhatsApp
                </a>
              </div>
            </div>
          </div>
        ))}
      </div>

      {modal && (
        <div id="modalBackdrop">
          <div id="modalContent">
            <h3>‚ûï Add Listing</h3>
            <form onSubmit={sendToAdmin}>
              <input placeholder="Item title *" required onChange={e=>setForm({...form,title:e.target.value})}/>
              <input type="number" placeholder="Price *" required onChange={e=>setForm({...form,price:e.target.value})}/>
              <input placeholder="Location *" required onChange={e=>setForm({...form,location:e.target.value})}/>
              <input placeholder="Mobile (optional)" onChange={e=>setForm({...form,mobile:e.target.value})}/>
              <button className="btn btn-success" style={{width:"100%",marginBottom:8}}>üì§ Send to Admin</button>
              <button type="button" className="btn btn-secondary" style={{width:"100%"}} onClick={()=>setModal(false)}>Cancel</button>
            </form>
          </div>
        </div>
      )}
    </>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>

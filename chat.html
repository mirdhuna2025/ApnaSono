<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Mirdhuna Chat ‚Ä¢ Nov 21, 2025</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* -------- Variables & reset -------- */
    :root{
      --bg-light: linear-gradient(135deg,#f0f9ff,#e0e7ff);
      --bg-dark: linear-gradient(135deg,#0b1220,#2b1b4a);
      --card: rgba(255,255,255,0.95);
      --glass: rgba(255,255,255,0.08);
      --primary: #6366f1;
      --accent: #ec4899;
      --success: #16a34a;
      --danger: #dc2626;
      --muted: #64748b;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(2,6,23,0.12);
      --transition: 180ms cubic-bezier(.2,.9,.2,1);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:#0f172a}
    body.light{background:var(--bg-light);color:#0f172a}
    body.dark{background:var(--bg-dark);color:#e6eef8}

    /* -------- Header -------- */
    header{
      position:sticky;top:0;z-index:120;
      display:flex;align-items:center;justify-content:space-between;
      gap:12px;padding:12px 14px;border-radius:0;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:46px;height:46px;border-radius:12px;background:linear-gradient(135deg,var(--primary),var(--accent));
      color:white;display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:var(--shadow)
    }
    .title{font-weight:700;font-size:16px;line-height:1}
    .header-actions{display:flex;align-items:center;gap:8px}

    .btn{
      border:0;padding:8px 12px;border-radius:12px;background:rgba(255,255,255,0.9);
      cursor:pointer;font-weight:600;transition:var(--transition);display:inline-flex;align-items:center;gap:8px;
    }
    .btn:active{transform:translateY(1px)}
    .icon-btn{width:44px;height:44px;border-radius:12px;border:0;display:inline-flex;align-items:center;justify-content:center}

    /* -------- Main layout -------- */
    .app{
      height:calc(100vh - 72px);display:flex;gap:12px;padding:14px;align-items:stretch;
    }
    .left{
      width:320px;max-width:38%;display:flex;flex-direction:column;gap:12px;
    }
    .panel{
      background:var(--card);border-radius:var(--radius);padding:12px;box-shadow:var(--shadow);
      overflow:auto;
    }
    .search{display:flex;gap:8px;align-items:center}
    .search input{flex:1;padding:10px;border-radius:12px;border:1px solid #e6edf6}

    .online-list{display:flex;gap:8px;flex-wrap:wrap}
    .online-item{display:flex;gap:8px;align-items:center;padding:6px 8px;border-radius:10px;background:rgba(0,0,0,0.03)}

    /* -------- Chat area -------- */
    .chat-wrap{flex:1;display:flex;flex-direction:column;gap:10px;min-width:0}
    .chat-box{flex:1;padding:18px;overflow:auto;border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.6));box-shadow:var(--shadow)}
    body.dark .chat-box{background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.08))}
    .message{display:flex;gap:12px;padding:12px;border-radius:14px;margin-bottom:12px;align-items:flex-start;position:relative}
    .message .meta{font-size:12px;color:var(--muted);margin-top:6px}
    .message .profile{width:48px;height:48px;border-radius:12px;object-fit:cover;border:2px solid rgba(0,0,0,0.06)}
    .msg-body{flex:1}
    .msg-header{display:flex;align-items:center;gap:8px;justify-content:space-between}
    .msg-name{font-weight:700}
    .admin-tag{font-size:11px;padding:3px 8px;border-radius:999px;background:var(--accent);color:white}
    .msg-text{margin-top:8px;white-space:pre-wrap;word-break:break-word}
    .media-content{max-width:360px;border-radius:12px;margin-top:8px;cursor:pointer;object-fit:cover;border:1px solid rgba(0,0,0,0.06)}
    .replies-section{margin-top:10px;padding-top:8px;border-top:1px dashed rgba(0,0,0,0.06)}
    .reply-inline{padding:8px;border-radius:10px;background:rgba(0,0,0,0.02);margin-top:6px}

    .actions{display:flex;gap:8px;margin-top:10px}
    .small-btn{padding:8px 10px;border-radius:10px;border:0;font-weight:600;cursor:pointer}

    /* composer */
    .composer{position:sticky;bottom:0;display:flex;gap:8px;padding:12px;background:transparent;align-items:center}
    .composer .input{flex:1;display:flex;gap:8px;align-items:center;background:var(--card);padding:8px;border-radius:14px;border:1px solid rgba(0,0,0,0.05)}
    .composer input[type="text"]{flex:1;padding:12px;border:0;outline:none;background:transparent;font-size:15px}
    .composer .media-btn{width:46px;height:46px;border-radius:12px;border:0;background:rgba(255,255,255,0.9);cursor:pointer}
    .send-btn{width:52px;height:52px;border-radius:14px;border:0;background:linear-gradient(90deg,var(--primary),var(--accent));color:white;font-weight:700;cursor:pointer}

    /* popups & modal */
    .popup, .media-modal, .edit-modal {position:fixed;inset:0;display:none;justify-content:center;align-items:center;background:rgba(0,0,0,0.45);z-index:1500}
    .popup .card, .media-modal .card, .edit-modal .card{background:var(--card);padding:18px;border-radius:14px;max-width:92%;max-height:92%;overflow:auto}
    .media-modal img, .media-modal video{max-width:95vw;max-height:80vh;border-radius:12px}

    /* admin panel (floating) */
    #adminPanel{position:fixed;top:84px;right:18px;width:320px;display:none;z-index:1600}

    /* small screens */
    @media (max-width:900px){
      .app{padding:10px;flex-direction:column}
      .left{width:100%;max-width:100%}
      .chat-wrap{width:100%}
      header{padding:10px}
      .logo{width:40px;height:40px}
    }

    /* hidden inputs */
    input[type="file"]{display:none}
  </style>
</head>
<body class="light">

  <header>
    <div class="brand">
      <div class="logo">MC</div>
      <div>
        <div class="title">Mirdhuna Chat</div>
        <div style="font-size:12px;color:var(--muted)">real-time ‚Ä¢ mobile-first ‚Ä¢ Nov 21, 2025</div>
      </div>
    </div>

    <div class="header-actions">
      <button id="themeToggle" class="btn">üåô Theme</button>
      <button id="exportBtn" class="btn">‚¨á Export</button>
      <button id="adminBtn" class="btn">üîê Admin</button>
      <img id="profileBtn" src="https://api.dicebear.com/7.x/thumbs/svg?seed=default" alt="profile" style="width:44px;height:44px;border-radius:12px;object-fit:cover;border:2px solid rgba(0,0,0,0.06);cursor:pointer" />
    </div>
  </header>

  <div class="app">
    <div class="left">
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Search / Filters</strong>
          <button id="clearSearch" class="btn" style="padding:6px 8px">Clear</button>
        </div>
        <div class="search">
          <input id="searchInput" placeholder="Search messages, names, dates..." />
          <button id="searchBtn" class="btn">Search</button>
        </div>
        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(0,0,0,0.04)">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Online (<span id="onlineCount">0</span>)</strong>
          <button id="refreshBtn" class="btn">üîÑ Refresh</button>
        </div>
        <div id="onlineList" class="online-list"></div>
        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(0,0,0,0.04)">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Settings</strong>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button id="toggleSound" class="btn">üîî Sound: On</button>
          <button id="clearChatBtn" class="btn" title="Admin only">üßπ Clear Chat</button>
          <div style="font-size:12px;color:var(--muted)">Tip: Persist profile to keep your avatar & name</div>
        </div>
      </div>

      <div class="panel" style="margin-top:12px">
        <strong>About</strong>
        <p style="margin-top:8px;font-size:13px;color:var(--muted)">This build includes presence, typing indicators, message edits, pins, offline queue, search, theme toggle, simple profanity filter, and admin moderation. Uses Firebase Realtime DB + Storage.</p>
      </div>
    </div>

    <div class="chat-wrap">
      <div id="chatBox" class="chat-box">
        <div style="text-align:center;opacity:0.7">üí¨ Welcome to Mirdhuna Chat ‚Äî Nov 21, 2025</div>
      </div>

      <div class="composer">
        <div class="input">
          <button id="cameraBtn" class="media-btn" title="Take Photo">üì∑</button>
          <button id="galleryBtn" class="media-btn" title="Upload">üñºÔ∏è</button>
          <input id="cameraInput" type="file" accept="image/*,video/*" capture="environment">
          <input id="galleryInput" type="file" accept="image/*,video/*" multiple>
          <input id="msg" type="text" placeholder="Type a message..." maxlength="1000" />
        </div>

        <button id="send" class="send-btn" title="Send">‚û§</button>
      </div>
    </div>
  </div>

  <!-- Reply Popup -->
  <div class="popup" id="replyPopup">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Reply</strong>
        <button id="replyClose" class="btn">‚úñ</button>
      </div>
      <input id="replyText" type="text" placeholder="Type reply..." />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="sendReply" class="btn">Send Reply</button>
        <button id="cancelReply" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Profile Popup -->
  <div class="popup" id="profilePopup">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Set Profile</strong>
        <button id="profileClose" class="btn">‚úñ</button>
      </div>
      <input id="name" placeholder="Display name (required)" />
      <input id="photo" type="file" accept="image/*" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="saveProfile" class="btn">Save</button>
        <button id="clearProfile" class="btn">Clear</button>
      </div>
    </div>
  </div>

  <!-- Edit Popup -->
  <div class="edit-modal" id="editModal">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Edit Message</strong>
        <button id="editClose" class="btn">‚úñ</button>
      </div>
      <input id="editText" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="saveEdit" class="btn">Save</button>
        <button id="cancelEdit" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Admin Login -->
  <div class="popup" id="adminPopup">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Admin Access</strong>
        <button id="adminClose" class="btn">‚úñ</button>
      </div>
      <input id="adminPass" placeholder="Admin password" type="password" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="adminLoginBtn" class="btn">Login</button>
        <button id="adminCancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Media Modal -->
  <div class="media-modal" id="mediaModal">
    <div class="card" id="mediaCard">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Media</strong>
        <button id="mediaClose" class="btn">‚úñ</button>
      </div>
      <div id="mediaContent"></div>
    </div>
  </div>

  <!-- Admin panel -->
  <div id="adminPanel" class="panel">
    <h4>üõ° Admin Dashboard</h4>
    <div style="display:flex;flex-direction:column;gap:8px">
      <button id="showModeration" class="btn">Moderation Log</button>
      <button id="banUserBtn" class="btn">Ban User (by name)</button>
      <div id="moderationLog" style="max-height:260px;overflow:auto;margin-top:8px"></div>
    </div>
  </div>

  <!-- Hidden download anchor -->
  <a id="downloadAnchor" style="display:none"></a>

  <script type="module" src="chat.js"></script>
</body>
</html>

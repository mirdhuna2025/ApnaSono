<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mirdhuna Media & Chat Admin</title>

<style>
:root {
    --bg: #121212;
    --card: #1e1e1e;
    --text: #ffffff;
    --primary: #bb86fc;
    --danger: #cf6679;
    --nav: #2c2c2c;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding-bottom: 80px;
}

/* Header */
header {
    background: var(--nav);
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
}

h1 { margin: 0; font-size: 1.2rem; }

.btn {
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin-left: 10px;
}

.btn-primary { background: var(--primary); color: #000; }
.btn-danger { background: var(--danger); color: #000; }
.btn-secondary { background: #555; color: #fff; }

/* Gallery */
.gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.media-card {
    background: var(--card);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    aspect-ratio: 1;
}

.media-card img,
.media-card video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    cursor: pointer;
}

.card-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0,0,0,0.8);
    padding: 5px;
    font-size: 0.7rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    opacity: 0;
    transition: 0.2s;
}

.media-card:hover .card-info { opacity: 1; }

.delete-btn {
    background: var(--danger);
    border: none;
    color: white;
    padding: 3px 8px;
    border-radius: 3px;
    cursor: pointer;
}

/* Chat Section */
#chatSection {
    max-width: 1200px;
    margin: 20px auto;
    padding: 20px;
    display: none;
}

.chat-item {
    background: var(--card);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chat-text { flex: 1; margin-right: 10px; }

.chat-actions button {
    margin-left: 5px;
    font-size: 0.8rem;
    padding: 5px 8px;
}

/* Modals */
.modal {
    display: none;
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.9);
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

.modal-content img,
.modal-content video {
    max-width: 90%;
    max-height: 80vh;
}

.login-box {
    background: var(--card);
    padding: 30px;
    border-radius: 10px;
    text-align: center;
}

.login-box input {
    width: 90%;
    padding: 10px;
    margin: 10px 0;
    background: #333;
    color: white;
    border: 1px solid #444;
    border-radius: 5px;
}
</style>
</head>

<body>

<header>
    <h1>üñºÔ∏è Media & Chat Admin</h1>
    <div>
        <button id="loginBtn" class="btn btn-primary">üîê Admin</button>
        <button id="logoutBtn" class="btn btn-danger" style="display:none;">üö™ Logout</button>
    </div>
</header>

<div id="gallery" class="gallery">
    <div>Loading media...</div>
</div>

<!-- Chat Section -->
<div id="chatSection">
    <h2>üí¨ Chat Messages</h2>
    <div id="chatList"></div>
</div>

<!-- View Modal -->
<div id="viewModal" class="modal">
    <div id="viewContent" class="modal-content"></div>
</div>

<!-- Login Modal -->
<div id="loginModal" class="modal">
    <div class="login-box">
        <h2>Admin Login</h2>
        <input type="password" id="adminPass" placeholder="Enter Password">
        <button class="btn btn-primary" onclick="adminLogin()">Login</button>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, onValue, remove, update } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
import { getStorage, ref as sRef, deleteObject } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_DOMAIN",
    databaseURL: "YOUR_DB_URL",
    projectId: "YOUR_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "YOUR_MSG_ID",
    appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

let user = JSON.parse(localStorage.getItem("chatUser")) || null;

const gallery = document.getElementById("gallery");
const chatSection = document.getElementById("chatSection");
const chatList = document.getElementById("chatList");

function updateUI(){
    if(user?.isAdmin){
        loginBtn.style.display="none";
        logoutBtn.style.display="inline-block";
        chatSection.style.display="block";
    }else{
        loginBtn.style.display="inline-block";
        logoutBtn.style.display="none";
        chatSection.style.display="none";
    }
}

/* Load Media */
function loadMedia(){
    onValue(ref(db,"messages"), snapshot=>{
        gallery.innerHTML="";
        const data=snapshot.val();
        if(!data){ gallery.innerHTML="No media."; return;}

        Object.entries(data).forEach(([key,msg])=>{
            if(!msg.mediaUrl) return;

            const card=document.createElement("div");
            card.className="media-card";

            const media = msg.mediaType?.startsWith("video")
            ? `<video src="${msg.mediaUrl}" onclick="viewMedia('${msg.mediaUrl}','video')"></video>`
            : `<img src="${msg.mediaUrl}" onclick="viewMedia('${msg.mediaUrl}','image')">`;

            const delBtn=user?.isAdmin
            ? `<button class="delete-btn" onclick="deleteMedia('${key}','${msg.storagePath||""}')">üóëÔ∏è</button>`
            : "";

            card.innerHTML=`
                ${media}
                <div class="card-info">
                    <span>${msg.user||"Unknown"}</span>
                    ${delBtn}
                </div>`;
            gallery.appendChild(card);
        });
    });
}

/* Load Chats */
function loadChats(){
    onValue(ref(db,"messages"), snapshot=>{
        chatList.innerHTML="";
        const data=snapshot.val();
        if(!data) return;

        Object.entries(data).forEach(([key,msg])=>{
            if(!msg.text) return;

            const div=document.createElement("div");
            div.className="chat-item";
            div.innerHTML=`
                <div class="chat-text">
                    <strong>${msg.user||"Unknown"}:</strong> ${msg.text}
                </div>
                <div class="chat-actions">
                    <button class="btn btn-secondary" onclick="editMessage('${key}')">‚úèÔ∏è</button>
                    <button class="btn btn-danger" onclick="deleteMessage('${key}')">üóëÔ∏è</button>
                </div>`;
            chatList.appendChild(div);
        });
    });
}

/* Delete Media */
window.deleteMedia=async(key,path)=>{
    if(!confirm("Delete media?")) return;
    if(path){
        try{ await deleteObject(sRef(storage,path)); }catch{}
    }
    await remove(ref(db,"messages/"+key));
};

/* Delete Chat */
window.deleteMessage=async(key)=>{
    if(!confirm("Delete message?")) return;
    await remove(ref(db,"messages/"+key));
};

/* Edit Chat */
window.editMessage=async(key)=>{
    const newText=prompt("Edit message:");
    if(!newText) return;
    await update(ref(db,"messages/"+key),{text:newText,edited:true});
};

/* View */
window.viewMedia=(url,type)=>{
    viewContent.innerHTML= type==="video"
    ? `<video src="${url}" controls autoplay></video>`
    : `<img src="${url}">`;
    viewModal.style.display="flex";
};

window.onclick=e=>{
    if(e.target==viewModal) viewModal.style.display="none";
    if(e.target==loginModal) loginModal.style.display="none";
};

/* Login */
loginBtn.onclick=()=>loginModal.style.display="flex";
logoutBtn.onclick=()=>{
    localStorage.removeItem("chatUser");
    location.reload();
};

window.adminLogin=()=>{
    if(adminPass.value==="sanu0000"){
        user={name:"Admin",isAdmin:true};
        localStorage.setItem("chatUser",JSON.stringify(user));
        location.reload();
    }else alert("Wrong password");
};

updateUI();
loadMedia();
loadChats();
</script>

</body>
</html>
